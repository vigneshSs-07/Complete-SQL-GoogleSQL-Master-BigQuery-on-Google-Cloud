ðŸ”¹ **BigQuery Function Deep Dive: `ARRAY_SLICE()`**

When working with arrays in BigQuery, sometimes you only need a **portion** of an array â€” for example, the first few elements of a customerâ€™s activity list, or the middle portion of a dataset for sampling or analysis. Thatâ€™s exactly what `ARRAY_SLICE()` is designed for.

### ðŸ§  **Function Overview**

```sql
ARRAY_SLICE(array_to_slice, start_offset, end_offset)
```

**Return Type:**
`ARRAY`

**Description**

Returns an array containing zero or more consecutive elements from the input array.

 * array_to_slice: The array that contains the elements you want to slice.
 * start_offset: The inclusive starting offset.
 * end_offset: The inclusive ending offset.

An offset can be positive or negative. A positive offset starts from the beginning of the input array and is 0-based. A negative offset starts from the end of the input array. Out-of-bounds offsets are supported. 

**What it does:**
Returns a subset of consecutive elements from an input array based on the given start and end offsets.

**Offsets:**

* Positive â†’ Count from the start (0-based)
* Negative â†’ Count from the end
* Out-of-bound offsets are handled gracefully
* Returns `NULL` if any argument is `NULL`

### Example

```sql
SELECT ARRAY_SLICE(['a', 'b', 'c', 'd', 'e'], 1, 3) AS result
```

/*-----------*
 | result    |
 +-----------+
 | [b, c, d] |
 *-----------*/

```sql
SELECT ARRAY_SLICE(['a', 'b', 'c', 'd', 'e'], -1, 3) AS result
```

/*-----------*
 | result    |
 +-----------+
 | []        |
 *-----------*/


```sql
SELECT ARRAY_SLICE(['a', 'b', 'c', 'd', 'e'], 1, 30) AS result
```

/*--------------*
 | result       |
 +--------------+
 | [b, c, d, e] |
 *--------------*/


### ðŸ§© **Practical Example**

Letâ€™s create a sample table and use `ARRAY_SLICE()` to extract specific segments of an array.

```sql
-- Step 1: Create a table
CREATE OR REPLACE TABLE dataset.product_views (
  user_id INT64,
  viewed_products ARRAY<STRING>
);

-- Step 2: Insert sample data
INSERT INTO dataset.product_views (user_id, viewed_products)
VALUES
  (1, ['Laptop', 'Mouse', 'Keyboard', 'Monitor', 'Headset']),
  (2, ['Shirt', 'Pants', 'Shoes', 'Watch', 'Belt']);

-- Step 3: Slice the arrays
SELECT
  user_id,
  ARRAY_SLICE(viewed_products, 1, 3) AS mid_items,        -- Elements from index 1 to 3
  ARRAY_SLICE(viewed_products, -3, -1) AS recent_items,   -- Last 3 elements
  ARRAY_SLICE(viewed_products, 0, 1) AS first_two_items   -- First 2 elements
FROM dataset.product_views;
```

ðŸ§® **Output:**

| user_id | mid_items                  | recent_items                 | first_two_items |
| ------- | -------------------------- | ---------------------------- | --------------- |
| 1       | [Mouse, Keyboard, Monitor] | [Keyboard, Monitor, Headset] | [Laptop, Mouse] |
| 2       | [Pants, Shoes, Watch]      | [Shoes, Watch, Belt]         | [Shirt, Pants]  |

ðŸ’¡ **Why Itâ€™s Useful:**

* Extract subsets of data without manually reconstructing arrays
* Handle both forward and reverse indexing easily
* Great for working with time-series or clickstream data where **position matters**


**Function Summary:**

* `ARRAY_SLICE()` â†’ Returns a continuous subset of an array
* **Return Type:** `ARRAY`
* Works with positive and negative offsets
* Handles `NULL` and out-of-range gracefully

