### 💡 **Understanding OFFSET vs ORDINAL in BigQuery Arrays**

If you’ve ever worked with **arrays in BigQuery**, you’ve probably seen these two functions:
`OFFSET()` and `ORDINAL()`.
They look similar — but there’s a subtle difference that can trip you up! ⚡

👩‍💻 **Here’s the key:**

* **`OFFSET(n)`** → starts counting from **0**
* **`ORDINAL(n)`** → starts counting from **1**

✅ **Example:**

```sql
SELECT
  my_array[OFFSET(0)] AS first_element_offset,
  my_array[ORDINAL(1)] AS first_element_ordinal
FROM my_table;
```

Both lines return the same element — the first one in the array.
But if you mix them up, your results might shift unexpectedly. 😅

📘 **Rule of thumb:**

* Use **`OFFSET()`** when you think in *zero-based indexing* (like most programming languages).
* Use **`ORDINAL()`** when you want *human-style numbering* — first = 1, second = 2, etc.


## 🧱 Step 1: Create a sample table

```sql
CREATE OR REPLACE TABLE demo.products AS
SELECT 
  1 AS id,
  ['apple', 'banana', 'cherry'] AS fruits
UNION ALL
SELECT 
  2 AS id,
  ['mango', 'kiwi', 'grapes'] AS fruits;
```

✅ You now have a table with:

| id | fruits                        |
| -- | ----------------------------- |
| 1  | ['apple', 'banana', 'cherry'] |
| 2  | ['mango', 'kiwi', 'grapes']   |

---

## 🍌 Step 2: Use `OFFSET()` (0-based index)

```sql
SELECT
  id,
  fruits[OFFSET(0)] AS first_fruit,
  fruits[OFFSET(1)] AS second_fruit
FROM demo.products;
```

🧠 **Explanation:**

* `OFFSET(0)` → first element
* `OFFSET(1)` → second element

✅ **Output:**

| id | first_fruit | second_fruit |
| -- | ----------- | ------------ |
| 1  | apple       | banana       |
| 2  | mango       | kiwi         |

---

## 🍒 Step 3: Use `ORDINAL()` (1-based index)

```sql
SELECT
  id,
  fruits[ORDINAL(1)] AS first_fruit,
  fruits[ORDINAL(2)] AS second_fruit
FROM demo.products;
```

🧠 **Explanation:**

* `ORDINAL(1)` → first element
* `ORDINAL(2)` → second element

✅ **Output:**

| id | first_fruit | second_fruit |
| -- | ----------- | ------------ |
| 1  | apple       | banana       |
| 2  | mango       | kiwi         |

---

## 🚨 Step 4: See the difference in indexing

If you try this 👇

```sql
SELECT
  id,
  fruits[OFFSET(2)] AS element_offset,
  fruits[ORDINAL(2)] AS element_ordinal
FROM demo.products;
```

✅ **Output:**

| id | element_offset | element_ordinal |
| -- | -------------- | --------------- |
| 1  | cherry         | banana          |
| 2  | grapes         | kiwi            |

🎯 Notice the shift:

* `OFFSET(2)` returns the **third** element
* `ORDINAL(2)` returns the **second** element

## 🔍 TL;DR:

| Function     | Index Starts At | Example      | Returns     |
| ------------ | --------------- | ------------ | ----------- |
| `OFFSET(n)`  | 0               | `OFFSET(0)`  | 1st element |
| `ORDINAL(n)` | 1               | `ORDINAL(1)` | 1st element |

#BigQuery #SQL #DataEngineering #GoogleCloud #Analytics #CloudComputing #Learning #DevOps #Terraform #Engineering

