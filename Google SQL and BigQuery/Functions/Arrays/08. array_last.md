ğŸ’¡ BigQuery Function Deep Dive: ARRAY_LAST()

When working with arrays in BigQuery, you might often need the last element â€” whether itâ€™s the most recent purchase, final event in a sequence, or the latest device a user logged in from.

### ğŸ” Syntax:

```sql
ARRAY_LAST(array_expression)
```

What it does: Returns the last element of an array.

âœ… **Key points:**

* Returns the **last element** of an array.
* Returns `NULL` if the array is `NULL`.
* Throws an **error** if the array is empty.
* The return type matches the array element type.

ğŸ“Š Example:
```sql
SELECT ARRAY_LAST(['a', 'b', 'c', 'd']) AS last_element;
```

âœ… Result:

last_element
d


ğŸ“ Real-World Use Case:

ğŸ“¦ Get the most recent product a customer purchased.
ğŸ“ˆ Retrieve the latest event in a userâ€™s activity timeline.
ğŸ“Š Identify the final stage in a business process.
ğŸ” Pro Tip: Combine ARRAY_FIRST() and ARRAY_LAST() to easily analyze both the start and end points of any array-based dataset.

### ğŸ“Š Real-World Example: Get the Last Purchased Category

Letâ€™s continue with our **e-commerce dataset** where each userâ€™s purchases are stored as an array. Now, we want to know the **last category** they purchased.

#### ğŸ›  Step 1: Create the table

```sql
CREATE OR REPLACE TABLE ecommerce.user_purchases (
  user_id STRING,
  categories ARRAY<STRING>
);
```

#### ğŸ“¥ Step 2: Insert sample data

```sql
INSERT INTO ecommerce.user_purchases (user_id, categories)
VALUES
  ('U001', ['Electronics', 'Books', 'Clothing']),
  ('U002', ['Groceries', 'Toys']),
  ('U003', ['Books']);
```

#### ğŸ“ˆ Step 3: Use `ARRAY_LAST()` to extract the last category

```sql
SELECT
  user_id,
  ARRAY_LAST(categories) AS last_category
FROM
  ecommerce.user_purchases;
```

âœ… **Result:**

| user_id | last_category |
| ------- | ------------- |
| U001    | Clothing      |
| U002    | Toys          |
| U003    | Books         |

---

ğŸ” **Use case:**

* Identify the **most recent product category** a user purchased.
* Track the **latest event** in a user journey.
* Retrieve the **final step** in a data pipeline output.

Pair this with `ARRAY_FIRST()` for powerful insights into user journeys â€” from **first touchpoint** to **most recent interaction**.

#BigQuery #GoogleCloud #DataEngineering #SQL #CloudAnalytics #GCP #DataAnalytics #TechTips
